[["dplyr-vs-pandas-numpy.html", "1 dplyr vs pandas &amp; numpy 1.1 select() 1.2 mutate() 1.3 filter() 1.4 group_by() and summarize() 1.5 arrange() 1.6 Helper Functions", " 1 dplyr vs pandas &amp; numpy We will use the five dplyr verbs (also pandas guide) for comparison select() picks variables based on their names. mutate() adds new variables that are functions of existing variables filter() picks cases based on their values. summarise() reduces multiple values down to a single summary. arrange() changes the ordering of the rows. and use the following toy data to apply the verbs. name gender grade Barney Male 10 Ted Male 11 Marshall Male 13 Lilly Female 12 Robin Female 14 Create Toy Data dplyr pandas df &lt;- tibble( name = c(&quot;Barney&quot;, &quot;Ted&quot;, &quot;Marshall&quot;, &quot;Lilly&quot;,&quot;Robin&quot;), gender = c(&quot;Male&quot;, &quot;Male&quot;,&quot;Male&quot;, &quot;Female&quot;, &quot;Female&quot;), grade = c(10, 11, 13, 12, 14) ) df ## # A tibble: 5 x 3 ## name gender grade ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Barney Male 10 ## 2 Ted Male 11 ## 3 Marshall Male 13 ## 4 Lilly Female 12 ## 5 Robin Female 14 df = pd.DataFrame({ &#39;name&#39;:[&quot;Barney&quot;, &quot;Ted&quot;, &quot;Marshall&quot;, &quot;Lilly&quot;, &quot;Robin&quot;], &#39;gender&#39;:[&quot;Male&quot;, &quot;Male&quot;,&quot;Male&quot;, &quot;Female&quot;, &quot;Female&quot;], &#39;grade&#39;:[10, 11, 13, 12, 14] }) df ## name gender grade ## 0 Barney Male 10 ## 1 Ted Male 11 ## 2 Marshall Male 13 ## 3 Lilly Female 12 ## 4 Robin Female 14 Check Data Structure dplyr pandas glimpse(df) ## Rows: 5 ## Columns: 3 ## $ name &lt;chr&gt; &quot;Barney&quot;, &quot;Ted&quot;, &quot;Marshall&quot;, &quot;Lilly&quot;, &quot;Robin&quot; ## $ gender &lt;chr&gt; &quot;Male&quot;, &quot;Male&quot;, &quot;Male&quot;, &quot;Female&quot;, &quot;Female&quot; ## $ grade &lt;dbl&gt; 10, 11, 13, 12, 14 df.dtypes ## name object ## gender object ## grade int64 ## dtype: object df.shape ## (5, 3) df.info() ## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt; ## RangeIndex: 5 entries, 0 to 4 ## Data columns (total 3 columns): ## name 5 non-null object ## gender 5 non-null object ## grade 5 non-null int64 ## dtypes: int64(1), object(2) ## memory usage: 248.0+ bytes 1.1 select() Task: Pick the variables name and grade. dplyr pandas df %&gt;% select(name, grade) ## # A tibble: 5 x 2 ## name grade ## &lt;chr&gt; &lt;dbl&gt; ## 1 Barney 10 ## 2 Ted 11 ## 3 Marshall 13 ## 4 Lilly 12 ## 5 Robin 14 df[[&#39;name&#39;, &#39;grade&#39;]] ## name grade ## 0 Barney 10 ## 1 Ted 11 ## 2 Marshall 13 ## 3 Lilly 12 ## 4 Robin 14 # or df.drop(columns = [&#39;gender&#39;]) ## name grade ## 0 Barney 10 ## 1 Ted 11 ## 2 Marshall 13 ## 3 Lilly 12 ## 4 Robin 14 # or df.drop([&#39;gender&#39;], axis = 1) ## name grade ## 0 Barney 10 ## 1 Ted 11 ## 2 Marshall 13 ## 3 Lilly 12 ## 4 Robin 14 1.2 mutate() Task: Generate a variable grade_p, expressing grade out of 100. dplyr pandas df %&gt;% mutate(grade_p = grade/20*100) ## # A tibble: 5 x 4 ## name gender grade grade_p ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Barney Male 10 50 ## 2 Ted Male 11 55 ## 3 Marshall Male 13 65 ## 4 Lilly Female 12 60 ## 5 Robin Female 14 70 df[&#39;grade_p&#39;] = df[&#39;grade&#39;]/20*100 df ## name gender grade grade_p ## 0 Barney Male 10 50.0 ## 1 Ted Male 11 55.0 ## 2 Marshall Male 13 65.0 ## 3 Lilly Female 12 60.0 ## 4 Robin Female 14 70.0 # now drop the newly created variable df.drop(columns = &#39;grade_p&#39;, inplace = True) 1.3 filter() Task: Keep Barney or females. dplyr pandas df %&gt;% filter(name == &quot;Barney&quot;| gender == &quot;Female&quot;) ## # A tibble: 3 x 3 ## name gender grade ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Barney Male 10 ## 2 Lilly Female 12 ## 3 Robin Female 14 # similar to base R df[(df[&quot;name&quot;] == &quot;Barney&quot;) | (df[&quot;gender&quot;] == &quot;Female&quot;)] ## name gender grade ## 0 Barney Male 10 ## 3 Lilly Female 12 ## 4 Robin Female 14 # query with &#39;&#39;; need to use &quot;&quot; for conditions df.query(&#39;name == &quot;Barney&quot;|gender == &quot;Female&quot;&#39;) ## name gender grade ## 0 Barney Male 10 ## 3 Lilly Female 12 ## 4 Robin Female 14 # query with &quot;&quot;; need to use &#39;&#39; for conditions df.query(&quot;name == &#39;Barney&#39;| gender == &#39;Female&#39;&quot;) ## name gender grade ## 0 Barney Male 10 ## 3 Lilly Female 12 ## 4 Robin Female 14 1.4 group_by() and summarize() Task: Grouped by gender, find mean grade. dplyr pandas df %&gt;% group_by(gender) %&gt;% summarize(avg_grade = mean(grade)) ## # A tibble: 2 x 2 ## gender avg_grade ## &lt;chr&gt; &lt;dbl&gt; ## 1 Female 13 ## 2 Male 11.3 # returns a series df.groupby(&quot;gender&quot;)[&#39;grade&#39;].mean() ## gender ## Female 13.000000 ## Male 11.333333 ## Name: grade, dtype: float64 # returns a data frame df[[&#39;gender&#39;, &#39;grade&#39;]].groupby(&quot;gender&quot;).mean() ## grade ## gender ## Female 13.000000 ## Male 11.333333 Task: Grouped by gender, find mean, median, minimum, and maximum grade. dplyr pandas df %&gt;% group_by(gender) %&gt;% summarize(mean = mean(grade), median = median(grade), min = min(grade), max = max(grade)) ## # A tibble: 2 x 5 ## gender mean median min max ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Female 13 13 12 14 ## 2 Male 11.3 11 10 13 df.groupby(&quot;gender&quot;)[&#39;grade&#39;].agg( # provide a dictionary {# variable name followed by function &#39;mean&#39;: &#39;mean&#39;, &#39;median&#39;: &#39;median&#39;, &#39;min&#39;: &#39;min&#39;, &#39;max&#39;: &#39;max&#39; } ) ## mean median min max ## gender ## Female 13.000000 13 12 14 ## Male 11.333333 11 10 13 ## ## C:/Users/Bhaswar/AppData/Local/r-miniconda/envs/r-reticulate/python.exe:7: FutureWarning: using a dict on a Series for aggregation ## is deprecated and will be removed in a future version. Use named aggregation instead. ## ## &gt;&gt;&gt; grouper.agg(name_1=func_1, name_2=func_2) 1.5 arrange() Task: Arrange grade in ascending order. dplyr pandas df %&gt;% arrange(grade) ## # A tibble: 5 x 3 ## name gender grade ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Barney Male 10 ## 2 Ted Male 11 ## 3 Lilly Female 12 ## 4 Marshall Male 13 ## 5 Robin Female 14 df.sort_values(&#39;grade&#39;) ## name gender grade ## 0 Barney Male 10 ## 1 Ted Male 11 ## 3 Lilly Female 12 ## 2 Marshall Male 13 ## 4 Robin Female 14 Task: Arrange grade in ascending order. dplyr pandas df %&gt;% arrange(desc(grade)) ## # A tibble: 5 x 3 ## name gender grade ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Robin Female 14 ## 2 Marshall Male 13 ## 3 Lilly Female 12 ## 4 Ted Male 11 ## 5 Barney Male 10 df.sort_values(&#39;grade&#39;, ascending = False) ## name gender grade ## 4 Robin Female 14 ## 2 Marshall Male 13 ## 3 Lilly Female 12 ## 1 Ted Male 11 ## 0 Barney Male 10 Task: Arrange gender in ascending order then arrange grade in descending order. dplyr pandas df %&gt;% arrange(gender, desc(grade)) ## # A tibble: 5 x 3 ## name gender grade ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Robin Female 14 ## 2 Lilly Female 12 ## 3 Marshall Male 13 ## 4 Ted Male 11 ## 5 Barney Male 10 df.sort_values([&#39;gender&#39;,&#39;grade&#39;], ascending = [True, False]) ## name gender grade ## 4 Robin Female 14 ## 3 Lilly Female 12 ## 2 Marshall Male 13 ## 1 Ted Male 11 ## 0 Barney Male 10 1.6 Helper Functions 1.6.1 case_when() vs pd.cut() vs np.select() Suppose we have a data frame with a variable called age. We want to create a variable age_cat with the following conditions: age &lt; 18: Kids 18 \\(\\leq\\) age &lt; 31: 18-30 31 \\(\\leq\\) age: 31 and above With dplyr::case_when() we can do it in the following way: # example data df &lt;- tibble(age = c(9, 10, 18, 21, 29, 31, 45)) # case_when() in action df %&gt;% mutate(age_cat = case_when( age &lt; 18 ~ &quot;Kids&quot;, age &gt;= 18 &amp; age &lt; 31 ~ &quot;18-30&quot;, age &gt;= 31 ~ &quot;31 and above&quot; )) ## # A tibble: 7 x 2 ## age age_cat ## &lt;dbl&gt; &lt;chr&gt; ## 1 9 Kids ## 2 10 Kids ## 3 18 18-30 ## 4 21 18-30 ## 5 29 18-30 ## 6 31 31 and above ## 7 45 31 and above We can achieve the same result in Python using np.select() pd.cut() df = pd.DataFrame({&#39;age&#39;: [9, 10, 18, 21, 29, 31, 45]}) numpy pandas # Step 1: Create conditions conditions = [ (df[&#39;age&#39;].lt(18)), (df[&#39;age&#39;].ge(18) &amp; (df[&#39;age&#39;].lt(31))), (df[&#39;age&#39;].ge(31)) ] # Step 2: Assign names based on the conditions cat_names = [&#39;Kids&#39;, &#39;18-30&#39;, &#39;30 and above&#39;] # Step 3: Use np.select() to generate the variable df[&#39;age_cat&#39;] = np.select(conditions, cat_names) df ## age age_cat ## 0 9 Kids ## 1 10 Kids ## 2 18 18-30 ## 3 21 18-30 ## 4 29 18-30 ## 5 31 30 and above ## 6 45 30 and above # Step 1: Create bin condition bin_cond = [0, 17, 30, np.inf] # note: instead of 0, # -np.inf will also work # Step 2: Assign bin labs bin_lab = [&#39;Kids&#39;, &#39;18-30&#39;, &#39;30 and above&#39;] # Step 3: Use pd.cut() df[&quot;age_cat&quot;] = pd.cut(df[&quot;age&quot;], bins=bin_cond, labels=bin_lab) df ## age age_cat ## 0 9 Kids ## 1 10 Kids ## 2 18 18-30 ## 3 21 18-30 ## 4 29 18-30 ## 5 31 30 and above ## 6 45 30 and above 1.6.2 if_else() vs np.where() Given prices of shirts price, how do we create a variable price_cat with the following conditions? when price is less than 50, we label it as Cheap when price is 50 or more, we label it as Expensive dplyr numpy # toy data prices &lt;- c(25, 30, 45, 80,100, 125) df &lt;- tibble(price = prices) # case_when in action df %&gt;% mutate(price_cat = if_else( price &lt;50, &quot;Cheap&quot;, &quot;Expenseive&quot; )) ## # A tibble: 6 x 2 ## price price_cat ## &lt;dbl&gt; &lt;chr&gt; ## 1 25 Cheap ## 2 30 Cheap ## 3 45 Cheap ## 4 80 Expenseive ## 5 100 Expenseive ## 6 125 Expenseive # toy data prices = {&#39;price&#39;: [25, 30, 45, 80,100, 125]} df = pd.DataFrame(prices) # np.where() in action df[&#39;price_cat&#39;] = np.where( df.price &lt; 50, &quot;Cheap&quot;, &quot;Expenseive&quot; ) df ## price price_cat ## 0 25 Cheap ## 1 30 Cheap ## 2 45 Cheap ## 3 80 Expenseive ## 4 100 Expenseive ## 5 125 Expenseive "]]
