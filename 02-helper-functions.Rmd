# Helper Functions

```{r setup-helper, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r lib-r-helper, echo = FALSE}
library(dplyr)
library(tidyr)
library(reticulate)
```

```{python lib-py-helper, echo = FALSE}
import pandas as pd
import numpy as np
```


## `case_when()` vs `pd.cut()` and `np.select()`

<span style="color:blue">*Suppose we have a data frame with a variable called `age`. We want to create a variable `age_cat` with the following conditions:*

  -  `age` < 18: "Kids"
  
  -  18 $\leq$ `age` < 31: "18-30"
  
  -  31 $\leq$ `age`: "31 and above"</span>

With `dplyr::case_when()` we can do it in the following way:

```{r}
# example data
df <- tibble(age = c(9, 10, 18, 21, 29, 31, 45))
# case_when() in action
df %>% 
  mutate(age_cat = case_when(
    age < 18 ~ "Kids",
    age >= 18 & age < 31 ~ "18-30",
    age >= 31 ~ "31 and above"
  ))
```

We can achieve the same result in Python using 

  - `np.select()`
  
  - `pd.cut()`

```{python}
df = pd.DataFrame({'age': [9, 10, 18, 21, 29, 31, 45]})
```


<table class='table'>
<tr> <th>numpy</th> <th>pandas</th> <tr>
<tr>
<td>

```{python}
# Step 1: Create conditions
conditions = [
  (df['age'].lt(18)),
  (df['age'].ge(18) & (df['age'].lt(31))),
  (df['age'].ge(31))
]
# Step 2: Assign names based on the conditions
cat_names = ['Kids', '18-30', '30 and above']

# Step 3: Use np.select() to generate the variable
df['age_cat'] = np.select(conditions, cat_names)
df
```

</td>
<td>
```{python}
# Step 1: Create bin condition
bin_cond = [0, 17, 30, np.inf] 
# note: instead of 0, 
#    -np.inf will also work

# Step 2: Assign bin labs
bin_lab = ['Kids', '18-30',
           '30 and above']

# Step 3: Use pd.cut() 
df["age_cat"] = pd.cut(df["age"],
                       bins=bin_cond,
                       labels=bin_lab)
df
```
</td>
<tr>
</table>

## `if_else()` vs `np.where()`

<span style="color:blue"> *Given prices of shirts `price`, how do we create a variable `price_cat` with the following conditions?*

  - when `price` is less than 50, we label it as "Cheap"
  
  - when `price` is 50 or more, we label it as "Expensive"</span>


<table class='table'>
<tr> <th>dplyr</th> <th>numpy</th> <tr>
<tr>
<td>

```{R}
# toy data
prices <- c(25, 30, 45, 80,100, 125)
df <- tibble(price = prices)
# case_when in action
df %>% 
  mutate(price_cat = if_else(
    price <50, "Cheap", "Expenseive"
  ))
```

</td>
<td>
```{python}
# toy data
prices = {'price': [25, 30, 45, 80,100, 125]}
df = pd.DataFrame(prices)
# np.where() in action
df['price_cat'] = np.where(
  df.price < 50, "Cheap", "Expenseive"
)
df
```
</td>
<tr>
</table>


## `%in%` vs `isin`, `@`, and `in`

|code |capital |
|:----|:-------|
|BD   |Dhaka   |
|PT   |Lisbon  |
|ES   |Madrid  |
|FR   |Paris   |

<span style="color:blue"> *How to keep observations that belong to BD or DE? *

<table class='table'>
<tr> <th>R</th> <th>Python</th> <tr>
<tr>
<td>

```{R}
# toy data
df <- tibble(
  # country code
  code = c(
    "BD", "PT",
    "ES", "FR"
  ),
  # capital
  capital = c(
    "Dhaka", "Lisbon",
    "Madrid", "Paris"
  ) 
)
df

```

```{r}
# %in% in action
df %>%
  filter(code %in% c("BD", "PT"))
```


</td>
<td>
```{python}
# toy data
data = {
    # country code
    'code':[
        "BD", "PT",
        "ES", "FR"
    ],
    # capital
    'capital':[
        "Dhaka", "Lisbon",
        "Madrid", "Paris"
    ]
}
df = pd.DataFrame(data)
df
```

**isin**

```{python}
# isin in action
df[df["code"].isin(["BD", "PT"])]
```

**`@`**

```{python}
country_list = ["BD", "PT"]
# @ in action
df.query('code == @country_list')
# note: you must create a list first
#   @["BD", "PT"] doesn't work
#   but, @list(["BD", "PT"] works
```
**in**

```{python}
# in in action
df.query('code in ["BD", "PT"]')
```


</td>
<tr>
</table>


